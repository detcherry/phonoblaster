<!DOCTYPE HTML>
<html xmlns:fb="http://www.facebook.com/2008/fbml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<!-- Page Meta Tags -->
		{% block meta %}
	    <title>Phonoblaster</title>
		<meta name="description" content="Broadcast your music! Create your station, play your favorite music and let the world listen to it!">
		{% endblock %}
		<!-- Facebook Open Graph Tags -->
		{% block facebook %}
			{% include "og.html" %}
		{% endblock %}
		<!-- Standard stylesheet -->
		<link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon" />
		<!-- Bootstrap stylesheet -->
		<link type="text/css" rel="stylesheet" href="/static/plugins/bootstrap/bootstrap.min.css">
		<!-- Fancybox stylesheet -->
		<link rel="stylesheet" href="static/plugins/fancybox/source/jquery.fancybox.css" type="text/css" media="screen"/>
		<!-- Base stylesheet -->
		<link type="text/css" rel="stylesheet" href="/static/css/base.css">
		<!-- Additional stylesheets -->
		{% block style %}
		{% endblock %}
	</head>
	<body>
		{% block header %}
			{% include "header.html" %}
		{% endblock %}
		<div id="main">
			<div class="container">
			{% block main %}
			{% endblock %}
			</div>
		</div>
		{% block footer %}
			{% include "footer.html" %}
		{% endblock %}
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
		<!-- Additional scripts -->
		<script type="text/javascript" src="static/plugins/fancybox/source/jquery.fancybox.pack.js"></script>
		<script type="text/javascript">
			// Global object
			function PhB(){
				this.facebook_app_id = "{{ facebook_app_id }}";
				this.version = "{{ version }}";
				this.time_delta = null;
			}
			PhB.prototype = {
				// Workaround for Firefox 3.6 and older versions
				log: function(content){
					if(console){
						console.log(content);
					}
				},
				
				// Fetch time on the server (because we can never trust the local clock...)
				time: function(callback){
					var that = this;
					$.ajax({
						url: "/api/now",
						type: "GET",
						dataType: "json",
						timeout: 60000,
						error: function(xhr, status, error){
							that.log(error);
						},
						success: function(json){
							var time = json.time;
							that.time_delta = Date.parse(new Date())/1000 - time;
							callback();
						},
					});
				},
				
				now: function(){
					var now = Date.parse(new Date())/1000 - this.time_delta
					return now;
				},
				
				error: function(error){
					this.popup(
						$("<div/>")
							.addClass("phb-popup-error")
							.append($("<img/>").attr("src", "/static/images/icon.png"))
							.append($("<p/>").html(error + " <br/><br/>Please try again later."))
						,{
						autoSize: false,
						width: 400,
						maxWidth: 400,
						height: 100,
						maxHeight: 100,
						topRatio: 0.3,
					});
				},
				
				// Trigger a popup containing HTML
				popup: function(html, options){
					$.fancybox(html, options);
				},
				
				// Converts seconds since epoch into a human readable time
				convert: function(time){					
					var date = new Date(parseInt(time)*1000);
					var hours = parseInt(date.getHours());
					if(hours < 10){
						hours = "0" + hours.toString()
					}
					var minutes = parseInt(date.getMinutes());
					if(minutes < 10){
						minutes = "0" + minutes.toString();
					}
					
					var displayed_time = hours +":"+minutes;
					return displayed_time;					
				},
				
				// Converts seconds of a duration into a human readable duration
				convertDuration: function(duration){
					var seconds = parseInt(duration,10) % 60;
					var minutes = (parseInt(duration, 10) - seconds)/60
					if(seconds < 10){
						seconds = "0"+ seconds.toString();
					}
					var displayed_duration = minutes.toString() + ":" + seconds;
					return displayed_duration;
				},
				
			}
			var PHB = new PhB();
		</script>
		<script type="text/javascript" src="/static/js/library/facebook.js"></script>
		{% block script %}
		{% endblock %}
		<!-- Twitter -->
		<script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
		<!-- Facebook -->
		<div id="fb-root"></div>
		 <script type="text/javascript">
	      	window.fbAsyncInit = function() {
		        FB.init({
					appId: '{{ facebook_app_id }}',
		 			status: true,
		 			cookie: true,
					xfbml: true,
					oauth: true,
				});
				
				// Login events
				$("a.login").click(function(){
					FACEBOOK.login();
					return false;	
				})
				
				$("a.logout").click(function(){
					FACEBOOK.logout();
					return false;
				})
				
	      	};
	      	(function() {
				var e = document.createElement('script');
				e.type = 'text/javascript';
				e.src = document.location.protocol + '//connect.facebook.net/en_US/all.js';
				e.async = true;
				document.getElementById('fb-root').appendChild(e);
			}());
		</script>
		<!-- Google Analytics -->
		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', '{{ google_analytics_id }}']);
			_gaq.push(['_trackPageview']);
			
			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
		<!-- Uservoice -->
		<script type="text/javascript">
			var uvOptions = {};
			(function() {var uv = document.createElement('script'); uv.type = 'text/javascript'; uv.async = true;
				uv.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'widget.uservoice.com/Q8AtdcldBGNsnq1dJ62BHw.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(uv, s);
			})();
		</script>
  	</body>
</html>
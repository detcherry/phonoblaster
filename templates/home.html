{% extends "base.html" %}

{% block main %}
	{% if current_user %}
	<!-- User is logged in-->
		<div class="station-listing">
			<h2>Your station</h2>
			<div id="your-station">
				{% if current_user_station %}
					<!-- User has a station-->
					<a href="/{{ current_user_station.identifier }}" class="img">
						<img src="/picture/view/{{ current_user_station.thumbnail.key }}"/>
					</a>
					<a href="/{{ current_user_station.identifier }}"><h3>{{ current_user_station.identifier }}</h3></a>
					<a href="/{{ current_user_station.identifier }}" class="button">Tune in!</a>
				{% else %}
					<!-- User does not have any station -->
					<form action="{{ blobstore_url }}" method="post" enctype="multipart/form-data" id="picture_upload">
						<div class="row">						
							<div class="left">
								<label for="picture">Picture*</label>
							</div>
							<div class="right">
								<div id="image_wrapper"></div>
								<input type="file" name="picture" id="picture"/>
								<img src="/static/images/small-ajax-loader.gif" style="clear:left; display:none"/>
								<div class="info">
									Maximum Size of 700k. JPEG, PNG, GIF
								</div>
							</div>
						</div>
					</form>
					<form action="/station/create" method="post" id="create_station">
						<div class="row">
							<div class="left">
								<label for="identifier">Name*</label>
							</div>
							<div class="right">
								<input type="text" name="identifier" maxlength="20" id="identifier"/>
								<div id="availability"></div>
								<div class="info">
									The station web address will be <strong>http://phonoblaster.com/<em id="station_id"></em></strong>
								</div>
							</div>
						</div>
						<div class="row">
							<div class="left">
							</div>
							<div class="right">
								<input type="submit" class="submit" value="Create now!"/><span> and start broadcasting your sound!</span>
							</div>
						</div>
					</form>
				{% endif %}
			</div>
		</div>
		{% if current_user_contributing_stations %}
		<div class="station-listing">
			<h2>Stations you contribute to</h2>
			<div id="station-items">
				{% for station in current_user_contributing_stations %}
				<div class="station-item">
					<h3><a href="/{{ station.identifier }}">{{ station.identifier }}</a></h3>
					<a href="/{{ station.identifier }}" class="img">
						<img src="/picture/view/{{ station.thumbnail.key }}">
					</a>
					<a href="/{{ station.identifier }}" class="button">Tune in!</a>
				</div>
				{% endfor %}
			</div>
		</div>
		{% endif %}
		{% if active_stations %}
			<div class="station-listing">
				<h2>Latest stations on the air</h2>
				<div id="station-items">
					{% for station in active_stations %}
					<div class="station-item">
						<h3><a href="/{{ station.identifier }}">{{ station.identifier }}</a></h3>
						<a href="/{{ station.identifier }}" class="img"><img src="/picture/view/{{ station.thumbnail.key }}"></a>
						<a href="/{{ station.identifier }}" class="button">Tune in!</a>
					</div>
					{% endfor %}
				</div>
			</div>
		{% else %}
			<div class="station-listing">
				<h2>Stations not yet on the air</h2>
				<div id="station-items">
					{% for station in non_active_stations %}
					<div class="station-item">
						<h3><a href="/{{ station.identifier }}">{{ station.identifier }}</a></h3>
						<a href="/{{ station.identifier }}" class="img"><img src="/picture/view/{{ station.thumbnail.key }}"></a>
						<a href="/{{ station.identifier }}" class="button">Tune in!</a>
					</div>
					{% endfor %}				
				</div>
			</div>	
		{% endif %}
	{% else %}
	<!-- User is not logged in-->
	<div id="welcome-top-left">
		<h2>Tune into people’s music!</h2>
		<p class="description">Music streams from your friends to your favorite bloggers, artists or brands.</p>
		<div id="welcome-action" class="button">
			<p id="facebook"><fb:login-button autologoutlink="true" scope="email"></fb:login-button></p>
			<p id="create">to create your station</p>
		</div>
		<div id="welcome-station-listing">
			{% if active_stations %}
				<h3>Stations on the air</h3>
				{% for station in active_stations %}
					<div class="welcome-station-item">
						<a href="/{{ station.identifier }}" class="img"><img src="/picture/view/{{ station.thumbnail.key }}"></a>
					</div>
				{% endfor %}
			{% else %}
				<h3>Stations not yet on the air</h3>
				{% for station in non_active_stations %}
					<div class="welcome-station-item">
						<a href="/{{ station.identifier }}" class="img"><img src="/picture/view/{{ station.thumbnail.key }}"></a>
					</div>
				{% endfor %}
			{% endif %}
		</div>
	</div>
	<div id="welcome-top-right">
		<div id="slideshow">
			<img src="/static/images/tracklist-state-1.png" class="active"/>
			<img src="/static/images/tracklist-state-2.png"/>
			<img src="/static/images/tracklist-state-3.png"/>
			<img src="/static/images/tracklist-state-4.png"/>
		</div>
		<img src="/static/images/welcome-animated.gif" id="animated"/>
	</div>
	<div id="separator"></div>
	<div class="welcome-bottom" style="width:33%;">
		<h4>Create your station</h4>
		<p>Turn on your own station, invite contributors, and start sharing your tasty music to the entire world!</p>
		<img src="/static/images/pyramides.png"/>
	</div>
	<div class="welcome-bottom" style="width:34%;">
		<h4>Share music together</h4>
		<p>Bring your friends in and broadcast together the greatest music selection<br/> of all times -	yes, you’re on the air!</p>
		<img src="/static/images/plane.jpg"/>
	</div>
	<div class="welcome-bottom" style="width:33%;">
		<h4>Discover new songs</h4>
		<p>No idea what to listen to today? Just tune into a station and listen to great new tracks immediately</p>
		<img src="/static/images/origami.jpg" style="margin-left:100px;"/>
	</div>
	{% endif %}
{% endblock %}

{% block script %}
	{% if not current_user %}
		<script type="text/javascript">
		function slideSwitch() {
		    var $active = $('#slideshow img.active');

		    if ( $active.length == 0 ) $active = $('#slideshow img:last');

		    // use this to pull the images in the order they appear in the markup
		    var $next =  $active.next().length ? $active.next()
		        : $('#slideshow img:first');

		    $active.addClass('last-active');
			/*
			//With fade in/out
		    $next.css({opacity: 0.0})
		        .addClass('active')
		        .animate({opacity: 1.0}, 1000, function() {
		            $active.removeClass('active last-active');
		        });
			*/
			//Without fade in/out
			$next.addClass("active")
			$active.removeClass("active last-active")
		}

		$(function() {
		    setInterval( "slideSwitch()", 3577 );
		});

		</script>
	{% else %}
		{% if not current_user_station %}
			<script type="text/javascript" src="/static/js/jquery.form.js"></script>
			<script type="text/javascript" src="/static/js/home.js"></script>
		{% endif %}
	{% endif %}
{% endblock %}

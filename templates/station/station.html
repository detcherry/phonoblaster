{% extends "station/root.html" %}

{% block meta %}
	<title>{{ station_proxy.station.name }}</title>
	<meta name="description" content="Listen now to {{ station_proxy.station.name }} music stream on Phonoblaster.">
{% endblock %}

{% block facebook %}
	<!-- Station Open Graph Tags -->
	<meta property="fb:app_id" content="{{ facebook_app_id }}"/>
	<meta property="og:type" content="{{ version }}:station"/> 
	<meta property="og:url" content="{{ site_url }}/{{ station_proxy.station.shortname }}"/> 
	<meta property="og:title" content="{{ station_proxy.station.name }}"/> 
	<meta property="og:description" content="Listen to {{ station_proxy.station.name }} station on Phonoblaster."/>
	<meta property="og:image"  content="https://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=large"/> 
	<meta property="og:site_name" content="Phonoblaster"/>
	<meta property="og:video:type" content="text/html"/>
	<meta property="og:video" content="{{ site_url }}/{{ station_proxy.station.shortname }}"/>
	<meta property="{{ version }}:page" content="{{ station_proxy.station.link }}"/>
{% endblock %}

{% block style %}
	<link type="text/css" rel="stylesheet" href="/static/css/station/station.css" />
{% endblock %}

{% block left-column %}
	<div class="row" id="presences" style="border:none">
		<a href="#">
			<strong class="number">0</strong>
			<span class="title">Listeners</span>
		</a>
	</div>
	<div id="presence-rows">
		<div id="admins-rows"></div>
		<div id="friends-rows"></div>
		<div id="authenticated-rows"></div>
	</div>
	<div class="row" id="sharethelove">
		<span class="btn">Share the love</span>
	</div>
{% endblock %}

{% block middle-column %}
	<div class="fixed">
		<div id="station-title">
			<h2>{{ station_proxy.station.name }}</h2>
			<div class="fb-like" data-href="{{ station_proxy.station.link }}" data-send="false" data-layout="button_count"  data-show-faces="false"></div>
		</div>
		<div id="live-video">
			<div id="youtube-player"></div>
			<div id="video-settings">
				<div id="counter-left">0:00</div>
				<div id="progression-bar"><div id="filler"></div></div>
				<div id="counter-right">0:00</div>
				<div id="volume">
					<a href="#">
						<img src="/static/images/unmuted.png" id="on"/>
						<img src="/static/images/muted.png" id="off" style="display:none;"/>
					</a>
				</div>
			</div>
		</div>
		<div id="live-broadcast">
			<span class="clip">
				<!-- No image -->
			</span>
			<div class="above-title">
				<h3>Current track</h3>
				<div id="store-track"></div>
			</div>
			<div class="title">
				<span class="middle">No track is being broadcast</span>
			</div>
			<div class="id"></div>
		</div>
	</div>
	<div id="live-comments">
		<div id="comment-box">
			{% if user_proxy %}
				{% if is_admin %}
				<img src="http://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=square">
				{% else %}
				<img src="http://graph.facebook.com/{{ user_proxy.user.key.name }}/picture?type=square">
				{% endif %}
			{% else %}
			<img src="/static/images/unknown-listener.png">
			{% endif %}
			<form method="post" action="" id="comment">
				<input type="text" name="comment" id="comment" value="Comment..." autocomplete="off"/>
				<input type="submit" value="Comment" class="submit"/>
			</form>
		</div>
		<div id="comments-zone">
		</div>
	</div>
{% endblock %}

{% block right-column %}
	<div id="station-status" class="fixed">
		{% if station_proxy.on_air %}
			<span class="btn danger">On air</span>
			<p><span class="middle"><strong>{{ station_proxy.station.name }}</strong> is <em>connected</em></span></p>
		{% else %}
			<span class="btn">Off air</span>
			<p><span class="middle"><strong>{{ station_proxy.station.name }}</strong> is <em>not connected</em></span></p>
		{% endif %}
		<div id="queue-status">
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<div id="queue-counter"><span>0</span>/10</div>
		</div>
	</div>
	<ul id="tabs" class="fixed">
		<li><a href="#queue-tab" class="current">Queue</a></li>
		<li style="width:86px;"><a href="#suggestions-tab" style="width:72px">Suggestions</a></li>
		{% if user_proxy %}
			{% if is_admin %}
			<li style="width:80px;"><a href="#favorites-tab" style="width:66px">Favorites</a></li>
			{% else %}
			<!-- A user non admin cannot suggest his tracks favorited from another station -->
			{% endif %}
			<li><a href="#library-tab">Library</a></li>
		{% endif%}
	</ul>
	<div id="tab-content-wrap">
		<div id="queue-tab" class="tab-content">
			<div id="queue-header" class="fixed">
				<span id="search-icon"></span>
				<input type="text" value="{% if is_admin %}Add a track{% else %}Suggest a track{% endif %}" id="search" autocomplete="off"/>
				<div id="search-overlay"></div>
				<div id="search-tab">
					<div class="tab-items">
					</div>
				</div>
			</div>
			<div class="tab-items">
				<div class="init">No track in the station queue</div>
			</div>
		</div>
		<div id="suggestions-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No suggestion</div>
			</div>
			<!-- Suggestion popup not displayed in the tab -->
			<div id="popup-suggestion">
				<div class="row" id="suggestion-recipient">
					<div class="left">To</div>
					<div class="right">{{ station_proxy.station.name }}</div>
				</div>
				<div class="row" id="suggestion-track">
					<div class="left">Track</div>
					<div class="right">
						<span class="clip"><!-- No image yet --></span>
						<div class="title"><span class="middle"><!-- No title yet --></span></div>
					</div>
				</div>
				<form action="#" method="post">
					<div class="row" id="suggestion-message">
						<div class="left">Message</div>
						<div class="right">
							<input type="text" id="youtube-id" name="youtube-id" style="display:none;">
							<textarea></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<input type="submit" class="btn primary" value="Suggest!"/>
						<div class="warning">A message must have 10+ characters.</div>
					</div>
				</form>
			</div>
		</div>
		<div id="favorites-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No favorite</div>
			</div>
		</div>
		<div id="library-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No track in your library</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block script %}
<!-- Pubnub -->
<div sub-key="sub-aa6b101e-24e9-11e1-ab04-3b69d50a7fd4" ssl="off" origin="pubsub.pubnub.com" id="pubnub"></div>
<script src="http://cdn.pubnub.com/pubnub-3.1.min.js"></script>
<!-- App Engine -->
<script type="text/javascript" src="/_ah/channel/jsapi"></script>
<!-- Station -->
<script type="text/javascript" src="/static/js/library/json2.js"></script>
<script type="text/javascript" src="/static/js/library/tab.js"></script>
<script type="text/javascript" src="/static/js/station/presence.js"></script>
<script type="text/javascript" src="/static/js/station/tab.js"></script>
<script type="text/javascript" src="/static/js/station/comment.js"></script>
<script type="text/javascript" src="/static/js/station/swfobject.js"></script>
<script type="text/javascript" src="/static/js/station/youtube.js"></script>
<script type="text/javascript" src="/static/js/station/queue.js"></script>
<script type="text/javascript" src="/static/js/station/suggestion.js"></script>
<script type="text/javascript" src="/static/js/station/search.js"></script>
<script type="text/javascript" src="/static/js/station/status.js"></script>
<script type="text/javascript" src="/static/js/station/favorite.js"></script>
<script type="text/javascript" src="/static/js/station/library.js"></script>
<script type="text/javascript" src="/static/js/station/viral.js"></script>
<script type="text/javascript" src="/static/js/station/station.js"></script>
<script type="text/javascript">
	/*--- Reset ---*/
	USER = null;
	ADMIN = false;
 	STATION = null;
	/*--- User Initialization ---*/
	{% if user_proxy %} 
	USER = {
		"key_name": "{{ user_proxy.user.key.name }}",
		"name": "{{ user_proxy.user.first_name }} {{ user_proxy.user.last_name }}",
	}
	{% endif %}
	/*--- Admin Initialization ---*/
	{% if is_admin %} 
	ADMIN = true;
	{% endif %}
	/*--- Station Initialization ---*/
	STATION = {
		"key_name": "{{ station_proxy.station.key.name }}",
		"shortname": "{{ station_proxy.station.shortname }}",
		"name": "{{ station_proxy.station.name}}",
	}
</script>
{% endblock %}

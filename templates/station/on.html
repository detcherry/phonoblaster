{% extends "station/root.html" %}

{% block style %}
	<link type="text/css" rel="stylesheet" href="/static/css/station/on.css" />
{% endblock %}

{% block left-column %}
	<div class="row" id="presences" style="border:none">
		<a href="#">
			<strong class="number">0</strong>
			<span class="title">Listeners</span>
		</a>
	</div>
	<div id="presence-rows">
		<div id="admins-rows"></div>
		<div id="friends-rows"></div>
		<div id="authenticated-rows"></div>
	</div>
	<div class="row" id="bring-people">
		<span class="btn primary tuto" data-original-title="Share this on Facebook!">
			{% if is_admin %}Bring your fans!{% else %}Bring friends!{% endif %}
		</span>
	</div>
	{% if user_proxy %}
	<!-- Bring people (friends of fans) popup -->
	<div id="popup-bring-people">
		{% if is_admin %}<h2>Share on {{ station_proxy.station.name }} Wall</h2>{% else %}<h2>Share on your Wall</h2>{% endif %}
		<form action="#" method="post">
			{% if is_admin %}
			<img class="thumbnail" src="https://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=square"/>
			{% else %}
			<img class="thumbnail" src="https://graph.facebook.com/{{ user_proxy.user.key.name }}/picture?type=square"/>
			{% endif %}
			<textarea></textarea>
			<img class="station" src="https://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=square"/>
			<div class="facebook-link">
				<span class="link">{{ station_proxy.station.name }}</span>
				<span class="description">Listen now to {{ station_proxy.station.name }} station on Phonoblaster.</span>
			</div>
			<div class="modal-footer">
				<input type="submit" class="btn primary" value="Share!"/>
			</div>
		</form>
	</div>
	{% endif %}
{% endblock %}

{% block middle-column %}
	<div class="fixed">
		<div id="station-title">
			<h2>{{ station_proxy.station.name }}</h2>
			<div class="fb-like" data-href="{{ station_proxy.station.link }}" data-send="false" data-layout="button_count"  data-show-faces="false"></div>
		</div>
		<div id="video">
			<div id="player-wrapper">
				<img src="/static/images/loader.gif"/>
				<!--<div id="youtube-player"></div>-->
			</div>
			<div id="video-settings">
				<div id="counter-left">0:00</div>
				<div id="progression-bar"><div id="filler"></div></div>
				<div id="counter-right">0:00</div>
				<div id="volume">
					<a href="#">
						<img src="/static/images/unmuted.png" id="on"/>
						<img src="/static/images/muted.png" id="off" style="display:none;"/>
					</a>
				</div>
			</div>
		</div>
		<div id="video-details">
			<span class="clip"><!-- No image --></span>
			<div class="above-title">
				<h3>Current track</h3>
				<div id="favorite-track"></div>
			</div>
			<div class="submitter"></div>
			<div class="title">
				<span class="middle">No track is being broadcast</span>
			</div>
			<div class="id"></div>
		</div>
	</div>
	<div id="comments">
		<div id="comment-box">
			{% if user_proxy %}
				{% if is_admin %}
				<img class="tuto" data-original-title="{{ station_proxy.station.name }}" src="http://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=square">
				{% else %}
				<img class="tuto" data-original-title="{{ user_proxy.user.first_name }} {{ user_proxy.user.last_name }}" src="http://graph.facebook.com/{{ user_proxy.user.key.name }}/picture?type=square">
				{% endif %}
			{% else %}
			<img src="/static/images/unknown-listener.png">
			{% endif %}
			<form method="post" action="" id="comment">
				<input type="text" name="comment" id="comment" value="Comment..." autocomplete="off"/>
				<span id="fb-sync" class="active tuto" data-original-title="Comment on Facebook: ON"></span>
				<input type="submit" value="Comment" class="submit"/>
			</form>
		</div>
		<div id="comments-zone">
		</div>
	</div>
{% endblock %}

{% block right-column %}
	<div id="station-status" class="fixed">
		<span class="btn">Off air</span>
		<p>
			<span class="middle">
				<strong>{{ station_proxy.station.name }}</strong> is <em>not connected</em>
			</span>
		</p>
		<div id="queue-status">
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<span class="grey circle"></span>
			<div id="queue-counter" class="tuto" data-original-title="Number of tracks in the queue or live. Max: 10 tracks at the same time"><span>0</span>/10</div>
		</div>
	</div>
	<div id="popup-offair">
		<h2>{{ station_proxy.station.name }} is now OFF AIR!</h2>
		<img src="https://graph.facebook.com/{{ station_proxy.station.key.name }}/picture?type=large" class="thumbnail"/>
		<h3>But you can still check out my latest broadcasts</h3>
		<div id="broadcasts"></div>
		<div class="modal-footer">
			<a href="/{{ station_proxy.station.shortname }}" class="btn primary">Check it out!</a>
		</div>
	</div>
	<ul id="tabs" class="fixed">
		<li class="tuto" data-original-title="Tracks soon on the air!">
			<a href="#queue-tab" class="current" id="queue-header">
				Queue
				<span class="round"></span>
			</a>
		</li>
		<li style="width:96px;" class="tuto" data-original-title="Tracks suggested by listeners to the broadcaster">
			<a href="#suggestions-tab" id="suggestions-header" style="width:84px">
				Suggestions
				<span class="round"></span>
			</a>
		</li>
		{% if user_proxy %}
			{% if is_admin %}
			<!-- Favorite tab is not displayed during first launch -->
			<!--<li style="width:80px;"><a href="#favorites-tab" style="width:66px">Favorites</a></li>-->
			{% else %}
			<!-- A user non admin cannot suggest his tracks favorited from another station -->
			{% endif %}
			<li class="tuto" data-original-title="Tracks you recently broadcast or suggested.">
				<a href="#library-tab">Library</a>
			</li>
		{% endif%}
	</ul>
	<div id="tab-content-wrap">
		<div id="queue-tab" class="tab-content">
			<div id="queue-header" class="fixed">
				<span id="search-icon"></span>
				<input type="text" value="{% if is_admin %}Add a track{% else %}Suggest a track{% endif %}" id="search" autocomplete="off" class="tuto" data-original-title="Search and add tracks from Youtube (soon: Soundcloud)"/>
				<div id="search-overlay"></div>
				<div id="search-tab">
					<div class="tab-items">
					</div>
				</div>
			</div>
			<div class="tab-items">
				<div class="init">No track in the station queue</div>
			</div>
			<!-- Recommandation popup not displayed in the tab -->
			<div id="popup-recommandation">
				<h2>Broadcast now!</h2>
				<h3>Put the tracks you recently posted on <strong></strong> in the queue!</h3>
				<div id="recommandations-zone">
					<img src="/static/images/loader.gif" class="loader">
				</div>
				<div class="modal-footer">
					<a class="btn primary">Go to station</a>
				</div>
			</div>
		</div>
		<div id="suggestions-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No suggestion</div>
			</div>
			<!-- Suggestion popup not displayed in the tab -->
			<div id="popup-suggestion">
				<div class="row" id="suggestion-recipient">
					<div class="left">To</div>
					<div class="right">{{ station_proxy.station.name }}</div>
				</div>
				<div class="row" id="suggestion-track">
					<div class="left">Track</div>
					<div class="right">
						<span class="clip"><!-- No image yet --></span>
						<div class="title"><span class="middle"><!-- No title yet --></span></div>
					</div>
				</div>
				<form action="#" method="post">
					<div class="row" id="suggestion-message">
						<div class="left">Message</div>
						<div class="right">
							<input type="text" id="youtube-id" name="youtube-id" style="display:none;">
							<textarea></textarea>
						</div>
					</div>
					<div class="modal-footer">
						<input type="submit" class="btn primary" value="Suggest!"/>
						<div class="warning">A message must have 10+ characters.</div>
					</div>
				</form>
			</div>
		</div>
		<div id="favorites-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No favorite</div>
			</div>
		</div>
		<div id="library-tab" class="tab-content">
			<div class="tab-items">
				<div class="init">No track in your library</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block script %}
<!-- Pubnub -->
<div sub-key="sub-aa6b101e-24e9-11e1-ab04-3b69d50a7fd4" ssl="off" origin="pubsub.pubnub.com" id="pubnub"></div>
<script src="http://cdn.pubnub.com/pubnub-3.1.min.js"></script>
<!-- App Engine -->
<script type="text/javascript" src="/_ah/channel/jsapi"></script>
<!-- Station -->
<script type="text/javascript" src="/static/js/library/json2.js"></script>
<script type="text/javascript" src="/static/js/library/tab.js"></script>
<script type="text/javascript" src="/static/js/library/favorite.js"></script>

<script type="text/javascript" src="/static/js/station/swfobject.js"></script>
<script type="text/javascript" src="/static/js/station/tab.js"></script>
<script type="text/javascript" src="/static/js/station/comment.js"></script>
<script type="text/javascript" src="/static/js/station/counter.js"></script>

<script type="text/javascript" src="/static/js/station/on/presence.js"></script>
<script type="text/javascript" src="/static/js/station/on/chromeless.js"></script>
<script type="text/javascript" src="/static/js/station/on/alert.js"></script>
<script type="text/javascript" src="/static/js/station/on/recommandation.js"></script>
<script type="text/javascript" src="/static/js/station/on/queue.js"></script>
<script type="text/javascript" src="/static/js/station/on/suggestion.js"></script>
<script type="text/javascript" src="/static/js/station/on/search.js"></script>
<script type="text/javascript" src="/static/js/station/on/status.js"></script>
<script type="text/javascript" src="/static/js/station/on/library.js"></script>
<script type="text/javascript" src="/static/js/station/on/viral.js"></script>
<script type="text/javascript" src="/static/js/station/on/air.js"></script>
<script type="text/javascript" src="/static/js/station/on/on.js"></script>
<script type="text/javascript">
	/*--- Reset ---*/
	USER = null;
	ADMIN = false;
 	STATION = null;
	/*--- User Initialization ---*/
	{% if user_proxy %} 
	USER = {
		"key_name": "{{ user_proxy.user.key.name }}",
		"name": "{{ user_proxy.user.first_name }} {{ user_proxy.user.last_name }}",
	}
	{% endif %}
	/*--- Admin Initialization ---*/
	{% if is_admin %} 
	ADMIN = true;
	{% endif %}
	/*--- Station Initialization ---*/
	STATION = {
		"key_name": "{{ station_proxy.station.key.name }}",
		"shortname": "{{ station_proxy.station.shortname }}",
		"name": "{{ station_proxy.station.name}}",
	}
</script>
{% endblock %}
